(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Stats"],{"024c":function(t,e,s){"use strict";var i=s("9ab4"),a=s("2b0e"),n=s("2fe1");let o=class extends a["default"]{get pane(){return this.$store.state.panes.panes[this.paneId]}mounted(){this.$el.id=this.paneId,this.refreshZoom(),this.$nextTick(()=>{const t=this.$el.clientWidth;"function"===typeof this.onResize&&this.onResize(t,this.$el.clientHeight,!0)}),this.$el.addEventListener("mousedown",this.focusPane)}beforeDestroy(){this.$el.removeEventListener("mousedown",this.focusPane),this._onStoreMutation&&this._onStoreMutation()}refreshZoom(){this.$store.dispatch("panes/refreshZoom",{id:this.paneId})}focusPane(){this.$store.commit("app/SET_FOCUSED_PANE",this.paneId)}};o=Object(i["a"])([Object(n["b"])({props:{paneId:{required:!0,type:String}}})],o),e["a"]=o},"3e68":function(t,e,s){"use strict";s("4367")},4367:function(t,e,s){},"8c91":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"pane-header hide-scrollbar d-flex",class:[t.split&&"pane-header--split"],on:{dblclick:t.maximizePane}},[t.showName&&t.name?e("div",{staticClass:"pane-header__name pane-overlay",on:{dblclick:t.renamePane}},[t._t("title",(function(){return[t._v(" "+t._s(t.name)+" ")]}))],2):t._e(),e("div",{staticClass:"toolbar pane-overlay"},[t._t("default"),t.showSearch?e("button",{staticClass:"btn toolbar__label toolbar__label--768 -text",attrs:{type:"button"},on:{click:t.openSearch}},[e("i",{staticClass:"icon-search"})]):t._e(),t.settings?e("btn",{staticClass:"toolbar__label toolbar__label--768 -text",attrs:{type:"button",loading:t.isLoading},on:{click:t.openSettings}},[e("i",{staticClass:"icon-cog"})]):t._e(),e("button",{staticClass:"btn -text toolbar__label",attrs:{type:"button"},on:{click:t.toggleDropdown}},[e("i",{staticClass:"icon-more"})]),e("dropdown",{model:{value:t.paneDropdownTrigger,callback:function(e){t.paneDropdownTrigger=e},expression:"paneDropdownTrigger"}},[e("div",{staticClass:"d-flex btn-group"},[e("button",{staticClass:"btn -green",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.changeZoom(e,-1)}}},[e("i",{staticClass:"icon-minus"})]),e("button",{staticClass:"btn -green text-monospace flex-grow-1 text-center",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.resetZoom.apply(null,arguments)}}},[t._v(" Ã— "+t._s(t.zoom.toFixed(2))+" ")]),e("button",{staticClass:"btn -green",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.changeZoom(e,1)}}},[e("i",{staticClass:"icon-plus"})])]),null!==t.settings?e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:t.openSettings}},[e("i",{staticClass:"icon-cog"}),e("span",[t._v("Settings")])]):t._e(),t.showSearch?e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:t.openSearch}},[e("i",{staticClass:"icon-search"}),e("span",[t._v("Sources")])]):t._e(),t.$slots.menu?e("div",{staticClass:"dropdown-divider",attrs:{"data-label":t.paneId+" options"}}):t._e(),t._t("menu"),e("div",{staticClass:"dropdown-divider",attrs:{"data-label":"utilities"}}),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:t.maximizePane}},[e("i",{staticClass:"icon-enlarge"}),e("span",[t._v("Maximize")])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:t.duplicatePane}},[e("i",{staticClass:"icon-copy-paste"}),e("span",[t._v("Duplicate")])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:t.downloadPane}},[e("i",{staticClass:"icon-download"}),e("span",[t._v("Download")])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:t.renamePane}},[e("i",{staticClass:"icon-edit"}),e("span",[t._v("Rename")])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:t.removePane}},[e("i",{staticClass:"icon-trash"}),e("span",[t._v("Remove")])])],2)],2)])},a=[],n=s("9ab4"),o=s("2b0e"),r=s("2fe1"),c=s("017a"),h=s("28f3"),l=s("0c01");let p=class extends o["default"]{constructor(){super(...arguments),this.paneDropdownTrigger=null,this.isLoading=!1}get zoom(){return this.$store.state.panes.panes[this.paneId].zoom||1}get type(){return this.$store.state.panes.panes[this.paneId].type}get name(){const t=this.$store.state.panes.panes[this.paneId].name,e=this.$store.state.panes.marketsListeners[this.$store.state.panes.panes[this.paneId].markets[0]];return t?t.trim():e?e.local:this.type}openSearch(){this.$store.dispatch("app/showSearch",{paneId:this.paneId})}changeZoom(t,e){const s=this.zoom+(t.shiftKey?.0625:.125)*e;this.$store.dispatch("panes/setZoom",{id:this.paneId,zoom:s}),this.$emit("zoom",s)}resetZoom(){this.$store.dispatch("panes/setZoom",{id:this.paneId,zoom:1}),this.$emit("zoom",1)}async removePane(){await l["a"].confirm(`Delete pane ${this.type} "${this.name}" ?`)&&this.$store.dispatch("panes/removePane",this.paneId)}duplicatePane(){this.$store.dispatch("panes/duplicatePane",this.paneId)}maximizePane(t){if("dblclick"===t.type&&t.currentTarget!==t.target)return;const e=this.$el.parentElement.parentElement,s=e.classList.toggle("-maximized"),i=Object(h["p"])(e);for(const n of i)n.getAttribute("type")&&(n.classList.remove("-maximized"),n.style.display=s?"none":"block");const a=Event;window.dispatchEvent(new a("resize")),this.$store.dispatch("panes/refreshZoom",{id:this.paneId,zoom:s?2:this.zoom})}async renamePane(t){t&&t.stopPropagation();const e=await l["a"].prompt({action:"Rename",input:this.name});"string"===typeof e&&e!==this.name&&this.$store.commit("panes/SET_PANE_NAME",{id:this.paneId,name:e})}async downloadPane(){Object(h["g"])({name:`${this.type}:${this.paneId}`,type:this.type,data:this.$store.state[this.paneId],markets:this.$store.state.panes.panes[this.paneId].markets,createdAt:Date.now(),updatedAt:null},Object(h["z"])(this.paneId))}toggleDropdown(t){this.paneDropdownTrigger?this.paneDropdownTrigger=null:this.paneDropdownTrigger=t.currentTarget}async openSettings(){this.settings&&(this.isLoading=!0,l["a"].open((await this.settings()).default,{paneId:this.paneId}),this.isLoading=!1)}};p=Object(n["a"])([Object(r["b"])({name:"PaneHeader",props:{paneId:{type:String},settings:{type:Function,default:null},showSearch:{type:Boolean,default:!0},showName:{type:Boolean,default:!0},split:{type:Boolean,default:!0}},components:{Btn:c["a"]}})],p);var d=p,u=d,m=s("2877"),b=Object(m["a"])(u,i,a,!1,null,null,null);e["a"]=b.exports},bdba:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"pane-stats"},[e("pane-header",{attrs:{paneId:t.paneId,settings:()=>s.e("chunk-10024d20").then(s.bind(null,"0c11"))}}),e("ul",{staticClass:"stats-buckets"},t._l(t.data,(function(s,i){return e("li",{key:i,staticClass:"stat-bucket",on:{click:function(e){return t.editStat(i)}}},[e("div",{staticClass:"stat-bucket__name"},[t._v(t._s(s.name))]),e("div",{staticClass:"stat-bucket__value"},[t._v(t._s(s.value))])])})),0),t.enableChart?e("div",{ref:"chart",staticClass:"stats-chart"}):t._e()],1)},a=[],n=s("9ab4"),o=s("60a3"),r=s("722a"),c=s("a914"),h=s("ecab"),l=s("0613"),p=s("fa07"),d=s("28f3");class u{constructor(t,e,s){this.stacks=[],this.filled=!1,this.remaining=0,this.timeouts=[],this.id=e.id,this.name=e.name,this.adapter=this.getAdapter(t),this.window=(isNaN(e.window)?l["b"].state[s].window:+e.window)||6e4,this.precision=e.precision,this.color=this.parseColor(e.color),this.granularity=Math.max(l["b"].state[s].granularity,this.window/5e3),this.type=e.type||"line";const i=Object(d["o"])(this.window).replace(/^1(\w)$/,"$1");this.name+="/"+i,this.clear()}getAdapter(t){const e=t.replace(/([^.]|^)(vbuy|vsell|cbuy|csell|lbuy|lsell)/g,"$1stats.$2");return new Function("stats",`'use strict'; return ${e};`)}clear(){this.stacks=[],this.live=0,this.filled=!1,this.remaining=0;for(let t=0;t<this.timeouts.length;t++)clearTimeout(this.timeouts[t]);this.timeouts=[]}unbind(){this.clear()}onStats(t){const e=this.adapter(t);if(!this.stacks.length||t.timestamp>this.timestamp+this.granularity)this.appendStack(t.timestamp);else if(this.filled&&this.remaining){const e=(t.timestamp-this.timestamp)/this.granularity,s=Math.ceil(this.stacks[0]*(1-e)),i=this.remaining-s;this.remaining=s,this.live-=i}this.addData(e)}appendStack(t){t||(t=Date.now()),this.stacks.length&&!this.stacks[this.stacks.length-1]||(this.stacks.push(0),this.timeouts.push(setTimeout(this.shiftStack.bind(this),this.window))),this.timestamp=t,this.filled||this.stacks.length!==this.window/this.granularity||(this.filled=!0)}shiftStack(){this.timeouts.shift();const t=this.stacks.shift();t&&(this.remaining&&(this.live-=this.remaining),this.remaining=this.stacks[0])}addData(t){this.stacks[this.stacks.length-1]+=t,this.live+=t}getValue(){return this.live}createSerie(t){if(this.serie)return;const e="add"+(this.type.charAt(0).toUpperCase()+this.type.slice(1))+"Series",s=Object.assign({},h["b"][this.type],{priceScaleId:this.name,title:this.name,priceLineVisible:!1,lineWidth:1,scaleMargins:{top:.05,bottom:.05},...this.getColorOptions()});this.serie=t[e](s)}updateSerie(){const t=this.getValue();if(!this.serie||!this.timestamp||"histogram"===this.type&&!t)return;const e={time:this.timestamp/1e3,value:t};"function"===typeof this.color&&(e.color=this.color(t)),this.serie.update(e)}getColorOptions(){if("function"===typeof this.color)return{};if("area"===this.type){let t,e,s;0===this.color.indexOf("#")?[t,e,s]=Object(p["i"])(this.color):[t,e,s]=Object(p["l"])(this.color);const i=`rgba(${t},${e},${s}, .4)`,a=`rgba(${t},${e},${s}, 0)`;return{topColor:i,bottomColor:a,lineColor:this.color}}return{color:this.color}}parseColor(t){return/rgba?\(|#/.test(t)?t:function(){return new Function("value",'"use strict"; return '+t)}()}updateColor(t){this.serie&&(this.color=this.parseColor(t),"string"===typeof t&&this.serie.applyOptions(this.getColorOptions()))}removeIndicator(t){this.serie&&(t.removeSeries(this.serie),delete this.serie)}}var m=s("2818"),b=s("0c01"),_=s("06c2"),k=s("024c"),f=s("8c91");let g=class extends(Object(o["b"])(k["a"])){constructor(){super(...arguments),this.data={},this._buckets={},this._feed=null}get enableChart(){return this.$store.state[this.paneId].enableChart}get buckets(){return this.$store.state[this.paneId].buckets}created(){this._onStoreMutation=this.$store.subscribe(t=>{switch(t.type){case"settings/SET_TEXT_COLOR":this._chart&&t.payload&&this._chart.applyOptions(Object(h["g"])(this.paneId));break;case"settings/SET_CHART_THEME":this._chart&&this._chart.applyOptions(Object(h["g"])(this.paneId));break;case"panes/SET_PANE_MARKETS":case this.paneId+"/SET_WINDOW":if(t.payload.id&&t.payload.id!==this.paneId)break;this.prepareBuckets();break;case this.paneId+"/SET_BUCKET_COLOR":this.recolorBucket(t.payload.id,t.payload.value);break;case this.paneId+"/SET_BUCKET_TYPE":this._chart&&this.reloadBucketSerie(t.payload.id,t.payload.value);break;case this.paneId+"/TOGGLE_CHART":t.payload?this.createChart():this.removeChart();break;case this.paneId+"/TOGGLE_BUCKET":t.payload.value?this.createBucket(this.buckets[t.payload.id]):this.removeBucket(t.payload.id);break;case"panes/SET_PANE_ZOOM":t.payload.id===this.paneId&&this.updateFontSize();break;case this.paneId+"/REMOVE_BUCKET":this.removeBucket(t.payload);break;case this.paneId+"/SET_BUCKET_WINDOW":case this.paneId+"/SET_BUCKET_INPUT":case this.paneId+"/SET_BUCKET_PRECISION":this.refreshBucket(t.payload.id);break;case this.paneId+"/RENAME_BUCKET":this.refreshBucketName(t.payload);break}}),this.prepareBuckets()}mounted(){this.enableChart&&this.createChart()}beforeDestroy(){this._feed&&c["a"].off(this._feed,this.onVolume),this.clearBuckets(),this.removeChart(),this._chart=null}async createChart(){await this.$nextTick();const t=Object(h["j"])(h["d"],this.paneId);this._chart=r["c"](this.$refs.chart,t);for(const e in this._buckets)this._buckets[e].createSerie(this._chart);this.refreshChartDimensions(0)}updateFontSize(){this._chart&&this._chart.applyOptions({layout:{fontSize:Object(h["h"])(this.paneId)}})}removeChart(){if(this._chart){for(const t in this._buckets)this._buckets[t].removeIndicator(this._chart);this._chart.remove(),this._chart=null}}async refreshChartDimensions(t=500){this.enableChart&&(clearTimeout(this._refreshChartDimensionsTimeout),this._refreshChartDimensionsTimeout=setTimeout(()=>{this._chart&&this._chart.resize(this.$el.clientWidth,this.$el.clientHeight)},t))}prepareBuckets(){this._feed&&c["a"].off(this._feed,this.onVolume),this.clearBuckets();for(const t in this.buckets)this.createBucket(this.buckets[t]);this._feed="bucket-"+Object(d["l"])(this.pane.markets),this._feed.length&&c["a"].on(this._feed,this.onVolume)}onVolume(t){for(const e in this._buckets){if(this._buckets[e].onStats(t),this._buckets[e].stacks.length){const t=this._buckets[e].getValue();this.$set(this.data[e],"value",Object(_["c"])(t,this._buckets[e].precision))}this._chart&&this._buckets[e].updateSerie()}}clearBuckets(){for(const t in this._buckets)this.removeBucket(t);this._buckets={}}removeBucket(t){this._buckets[t]&&(this._buckets[t].unbind(),this._chart&&this._buckets[t].removeIndicator(this._chart),this.$delete(this.data,t),delete this._buckets[t])}refreshBucket(t){const e=this.buckets[t];e&&(this.removeBucket(t),this.createBucket(e))}recolorBucket(t,e){this._buckets[t]&&(this._buckets[t].updateColor(e),this.$set(this.data[t],"color",e))}reloadBucketSerie(t,e){this._buckets[t]&&(e&&(this._buckets[t].type=e),this._buckets[t].removeIndicator(this._chart),this._buckets[t].createSerie(this._chart))}createBucket(t){if(t.enabled&&"undefined"===typeof this.data[t.id]){const e=new u(t.input,t,this.paneId);this._chart&&e.createSerie(this._chart),this._buckets[t.id]=e,this.$set(this.data,e.id,{value:0,name:e.name,color:e.color})}}refreshBucketName({id:t,name:e}){const s=this._buckets[t];s.name=e,this.$set(this.data[t],"name",e)}editStat(t){b["a"].open(m["a"],{paneId:this.paneId,bucketId:t})}onResize(){this.refreshChartDimensions()}};g=Object(n["a"])([Object(o["a"])({components:{PaneHeader:f["a"]},name:"Stats"})],g);var y=g,C=y,v=(s("3e68"),s("2877")),w=Object(v["a"])(C,i,a,!1,null,null,null);e["default"]=w.exports}}]);